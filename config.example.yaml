# Dual-Stream Documentation System - Configuration
# Copy this file to config.yaml and customize for your project

# =============================================================================
# Codebase Configuration
# =============================================================================
codebase:
  # Path to the codebase to document (required)
  path: /path/to/legacy/codebase

  # Primary programming language
  language: python  # python, java, javascript, typescript, multi

  # File patterns to exclude from documentation
  exclude_patterns:
    - "**/test_*"
    - "**/tests/**"
    - "**/__pycache__/**"
    - "**/venv/**"
    - "**/.venv/**"
    - "**/node_modules/**"
    - "**/*.pyc"
    - "**/.git/**"

  # Optional: File patterns to include (empty = all matching language)
  include_patterns: []

  # Optional: Entry point modules for dependency analysis
  entry_points:
    - main
    - app

# =============================================================================
# Model Configuration
# =============================================================================
models:
  # Stream A configuration (Anthropic-based by default)
  stream_a:
    documenter: claude-sonnet-4-5  # Generation tier
    validator: claude-haiku-4-5    # Validation tier

  # Stream B configuration (OpenAI-based by default)
  stream_b:
    documenter: gpt-4o       # Generation tier
    validator: gpt-4o-mini   # Validation tier

  # Comparator/Arbitrator (premium model)
  comparator: claude-opus-4-5  # Arbitration tier

  # Custom model definitions (optional)
  # Use this to add new models or override defaults
  custom_models:
    # Example custom model:
    # my-custom-model:
    #   name: "my-custom-model-id"
    #   provider: openrouter
    #   tier: generation
    #   cost_per_million_input: 5.0
    #   cost_per_million_output: 15.0
    #   max_tokens: 4096
    #   temperature: 0.0
    #   context_window: 100000

# =============================================================================
# Convergence Configuration
# =============================================================================
convergence:
  # Maximum iterations before forced convergence
  max_iterations: 5

  # Required call graph match rate between streams
  call_graph_match_threshold: 0.98

  # Required documentation similarity between streams
  documentation_similarity_threshold: 0.95

  # Maximum unresolved non-blocking discrepancies allowed
  max_open_discrepancies: 2

  # Timeout waiting for Beads ticket resolution (hours, 0 = don't wait)
  beads_ticket_timeout_hours: 48

# =============================================================================
# Beads Integration (Git-Backed Issue Tracking)
# =============================================================================
# Beads is a distributed issue tracker designed for AI agents.
# See https://github.com/steveyegge/beads for setup.
beads:
  # Enable/disable Beads integration
  enabled: true

  # Beads directory (relative to repo root)
  directory: ${BEADS_DIR:.beads}

  # Default labels for created issues
  labels:
    - ai-documentation
    - twinscribe

  # Automatically create issues for discrepancies
  auto_create_issues: ${BEADS_AUTO_CREATE:true}

  # Priority for discrepancy issues (0=highest, higher=lower priority)
  discrepancy_priority: 1

  # Priority for rebuild story issues
  rebuild_priority: 0

# =============================================================================
# Static Analysis Configuration
# =============================================================================
static_analysis:
  # Python analyzers
  python:
    primary:
      enabled: true
      # executable: /path/to/pycg  # Optional: custom path
      timeout_seconds: 300
      extra_args: []
    fallback:
      enabled: true
      timeout_seconds: 300

  # Java analyzers (if language is java)
  java:
    primary:
      enabled: true
      timeout_seconds: 300
    fallback:
      enabled: true
      timeout_seconds: 600

  # JavaScript/TypeScript analyzers
  javascript:
    primary:
      enabled: true
      timeout_seconds: 300

  # Multi-language fallback (Sourcetrail)
  multi_language_fallback:
    enabled: true
    timeout_seconds: 600

  # Result caching
  cache_enabled: true
  cache_ttl_hours: 24

# =============================================================================
# CrossCheck Verification Framework
# =============================================================================
# The CrossCheck Verification Framework validates documentation quality
# and accuracy using multiple verification strategies.
verification:
  # Enable/disable the verification framework (disabled by default)
  enabled: ${VERIFICATION_ENABLED:false}

  # Verification strategies to run
  # Available: qa_interrogation, masked_reconstruction, scenario_walkthrough,
  #            mutation_detection, impact_analysis, adversarial_review, test_generation
  enabled_strategies:
    - qa_interrogation
    - masked_reconstruction
    - scenario_walkthrough
    - mutation_detection
    - impact_analysis
    - adversarial_review
    - test_generation

  # Score thresholds for passing verification
  thresholds:
    min_overall_quality: 0.85   # Minimum overall quality score to pass
    min_qa_score: 0.80          # Minimum Q&A interrogation score
    min_reconstruction_score: 0.75  # Minimum masked reconstruction score
    min_scenario_score: 0.85    # Minimum scenario walkthrough score
    min_test_pass_rate: 0.90    # Minimum generated test pass rate

  # Q&A Interrogation Strategy
  # Generates questions about code behavior and validates documentation answers
  qa_interrogation:
    questions_per_component: 5
    categories:
      - return_value
      - error_handling
      - edge_case
      - call_flow

  # Masked Reconstruction Strategy
  # Masks code elements and validates documentation completeness
  masked_reconstruction:
    mask_ratio: 0.3
    mask_types:
      - constants
      - conditions
      - returns

  # Scenario Walkthrough Strategy
  # Creates usage scenarios to validate documentation accuracy
  scenario_walkthrough:
    scenarios_per_component: 3
    types:
      - happy_path
      - error_path
      - edge_case

  # Mutation Detection Strategy
  # Introduces mutations to validate documentation sensitivity
  mutation_detection:
    mutations_per_component: 5
    mutation_types:
      - boundary
      - off_by_one
      - null_handling

  # Adversarial Review Strategy
  # Uses adversarial model to find documentation issues
  adversarial_review:
    max_findings_per_component: 10

  # Test Generation Strategy
  # Generates tests from documentation to validate accuracy
  test_generation:
    tests_per_component: 10
    run_generated_tests: true

# =============================================================================
# Output Configuration
# =============================================================================
output:
  # Base output directory
  base_dir: ./output

  # Output file names
  documentation_file: documentation.json
  call_graph_file: call_graph.json
  rebuild_tickets_file: rebuild_tickets.json
  convergence_report_file: convergence_report.json
  metrics_file: metrics.json

  # Create output directories if they don't exist
  create_dirs: true

# =============================================================================
# Logging Configuration
# =============================================================================
logging:
  # Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
  level: ${TWINSCRIBE_LOG_LEVEL:INFO}

  # Log format (Python logging format string)
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"

  # Log file path (optional, leave empty for stdout only)
  file: ${TWINSCRIBE_LOG_FILE:}

  # Output logs as JSON (for structured logging / log aggregation)
  json_output: false

  # Include timestamp in log output
  include_timestamp: true

  # Include module name in log output
  include_module: true

# =============================================================================
# Runtime Options
# =============================================================================
# Enable debug mode (verbose logging)
debug: ${TWINSCRIBE_DEBUG:false}

# Dry run mode (don't make changes, just report what would happen)
dry_run: ${TWINSCRIBE_DRY_RUN:false}
